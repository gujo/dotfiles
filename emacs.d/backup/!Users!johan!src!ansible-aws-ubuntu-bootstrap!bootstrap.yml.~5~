---
- hosts: newservers
  remote_user: ubuntu
  sudo: yes
  
  vars:
    - ubuntu_release: precise
    - root_password: ''
    - deploy_password: ''

  tasks:
    - name: update apt cache
      action: apt update_cache=yes

    - name: update apt to latest version
      action: apt upgrade=safe

# Comment
      
    - name: Disallow password authentication
      action: lineinfile dest=/etc/ssh/sshd_config regexp="^PasswordAuthentication" line="PasswordAuthentication no" state=present
      notify: Restart ssh

    - name: Disallow root SSH access
      lineinfile: dest=/etc/ssh/sshd_config regexp="^PermitRootLogin" line="PermitRootLogin no" state=present
      notify: Restart ssh

    - name: Disallow password authentication
      lineinfile: dest=/etc/ssh/sshd_config regexp="^PasswordAuthentication" line="PasswordAuthentication no" state=present
      notify: Restart ssh